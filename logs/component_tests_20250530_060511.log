=== Component Test: camera_player_sync_component_test ===
Exit code: 0
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized

==================================================
 CAMERAPLAYERSYNCCOMPONENTTEST TEST SUITE
==================================================


===== TEST SUITE: Process Synchronization Tests =====
Setting test_mode to: True
Initializing TestBoundsValidator for test mode
TestBoundsValidator initialized - bounds validation disabled for testing
BoundsValidator initialized: Reference
ScrollingCamera._ready() called - Script Path: res://src/core/camera/scrolling_camera.gd
ScrollingCamera class loaded - Script ID: 1308
[TRACE] Camera initialized with screen size: (1424, 952)
Debug drawing is disabled
No target player set

[TEST] test_camera_and_player_use_same_process_method
  âœ“ PASS: test_camera_and_player_use_same_process_method: Camera and player should use the same process method (both physics or both regular)

===== TEST SUITE: Movement Synchronization Tests =====
Setting test_mode to: True
Initializing TestBoundsValidator for test mode
TestBoundsValidator initialized - bounds validation disabled for testing
BoundsValidator initialized: Reference
ScrollingCamera._ready() called - Script Path: res://src/core/camera/scrolling_camera.gd
ScrollingCamera class loaded - Script ID: 1320
[TRACE] Camera initialized with screen size: (1424, 952)
Debug drawing is disabled
No target player set

[TEST] test_camera_tracks_player_without_lag
Cannot move to: (500, 300) - not in walkable area
  âœ“ PASS: test_camera_tracks_player_without_lag: Camera should stay within 5 pixels of player (0.0% frames exceeded limit)

===== TEST SUITE: Frame Timing Tests =====
Setting test_mode to: True
Initializing TestBoundsValidator for test mode
TestBoundsValidator initialized - bounds validation disabled for testing
BoundsValidator initialized: Reference
ScrollingCamera._ready() called - Script Path: res://src/core/camera/scrolling_camera.gd
ScrollingCamera class loaded - Script ID: 1330
[TRACE] Camera initialized with screen size: (1424, 952)
Debug drawing is disabled
No target player set

[TEST] test_camera_updates_after_player

==================================================
 SUMMARY: 2 passed, 0 failed
==================================================

[PASS] All CameraPlayerSyncComponentTest tests passed!
[CAMERA DEBUG] CoordinateManager singleton not available for registration
[CAMERA DEBUG] CoordinateManager singleton not available for registration
[CAMERA DEBUG] CoordinateManager singleton not available for registration
ERROR: Resumed function '_ready()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:39
   at: resume (modules/gdscript/gdscript_function.cpp:1802)
ERROR: Resumed function '_ready()' after yield, but class instance is gone. At script: res://src/core/camera/scrolling_camera.gd:441
   at: resume (modules/gdscript/gdscript_function.cpp:1802)
Setting target_player to: @@11:[Node2D:1328]
[CAMERA DEBUG] Camera state changed from IDLE to FOLLOWING_PLAYER
ERROR: Resumed function '_ready()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:39
   at: resume (modules/gdscript/gdscript_function.cpp:1802)
ERROR: Resumed function '_ready()' after yield, but class instance is gone. At script: res://src/core/camera/scrolling_camera.gd:441
   at: resume (modules/gdscript/gdscript_function.cpp:1802)
Setting target_player to: @@11:[Node2D:1328]
Player linked to district: Test District
Camera found player: @@11
Using default camera bounds based on screen size
Initializing TestBoundsValidator for test mode
TestBoundsValidator initialized - bounds validation disabled for testing
BoundsValidator initialized: Reference

===== CAMERA INITIAL POSITION SETUP =====
Current camera position: (512, 300)
Initial position setting: (0, 0)
Initial view setting: right
Screen size: (1424, 952)

===== CALCULATING OPTIMAL ZOOM =====
Could not find background information - camera zoom unchanged
===== ZOOM CALCULATION COMPLETE =====

Camera half size (screen size / 2 / zoom): (712, 476)
Camera bounds: (0, 0, 1424, 952)
Background wide enough for scrolling: False
Background width: 1424, Min width for scrolling: 2136
Using RIGHT initial view setting
Centering camera on walkable area: (712, 476)
Setting camera position to: (712, 476)
Camera position after setting: (712, 476)
[CAMERA DEBUG] Checking camera position against walkable area center
Camera positioned for initial view: right at (712, 476)
View ratio: 100% of background is visible (1424 pixels of 1424 pixels)
===== CAMERA INITIAL POSITION SETUP COMPLETE =====

[CAMERA DEBUG] Camera initialized in FOLLOWING_PLAYER state
Setting target_player to: @@11:[Node2D:1328]
  Frame 0: physics=0, process=0
ensure_valid_target called with position: (657, 300)
Current test_mode value: True
[TEST] Bypassing all bounds validation due to test_mode=true for: (657, 300)
[CAMERA DEBUG] Smoothing value: 5, weight: 0.083333
[CAMERA DEBUG] Using normal interpolation
[CAMERA DEBUG] Camera following player: (100, 300) -> (705, 453)
ensure_valid_target called with position: (657, 300)
Current test_mode value: True
[TEST] Bypassing all bounds validation due to test_mode=true for: (657, 300)
[CAMERA DEBUG] Smoothing value: 5, weight: 0.083333
[CAMERA DEBUG] Using normal interpolation
[CAMERA DEBUG] Camera following player: (100, 300) -> (699, 433)
ensure_valid_target called with position: (657, 300)
Current test_mode value: True
[TEST] Bypassing all bounds validation due to test_mode=true for: (657, 300)
[CAMERA DEBUG] Smoothing value: 5, weight: 0.083333
[CAMERA DEBUG] Using normal interpolation
[CAMERA DEBUG] Camera following player: (100, 300) -> (694, 416)
ensure_valid_target called with position: (657, 300)
Current test_mode value: True
[TEST] Bypassing all bounds validation due to test_mode=true for: (657, 300)
[CAMERA DEBUG] Smoothing value: 5, weight: 0.083333
[CAMERA DEBUG] Using normal interpolation
[CAMERA DEBUG] Camera following player: (100, 300) -> (689, 401)
ensure_valid_target called with position: (657, 300)
Current test_mode value: True
[TEST] Bypassing all bounds validation due to test_mode=true for: (657, 300)
[CAMERA DEBUG] Smoothing value: 5, weight: 0.083333
[CAMERA DEBUG] Using normal interpolation
[CAMERA DEBUG] Camera following player: (100, 300) -> (685, 388)
  Frame 1: physics=0, process=0

=== Component Test: camera_walkable_component_test ===
Exit code: 0
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized
Setting up Camera-Walkable Area component test...
Setting test_mode to: False
Initializing DefaultBoundsValidator with bounds: (0, 0, 0, 0)
BoundsValidator initialized: Reference
ScrollingCamera._ready() called - Script Path: res://src/core/camera/scrolling_camera.gd
ScrollingCamera class loaded - Script ID: 1305
[TRACE] Camera initialized with screen size: (1424, 952)
Debug drawing is disabled
No target player set
Test scene created with district, walkable area, camera, and player
Starting Camera-Walkable Area component tests...
Running test suite: bounds_calculation with timeout protection
===== TEST SUITE: Bounds Calculation =====
Running test: Camera Calculates Bounds

========== DISTRICT BOUNDS CALCULATION STARTED ==========
Background dimensions: (1000, 600)
Screen size: (1424, 952)
Current camera zoom: (1, 1)
Number of walkable areas: 1

========== BOUNDS CALCULATION STARTED ==========
Number of walkable areas: 1
Using get_polygon() interface method
Processing walkable area: WalkableArea with 4 points
Area transform: ((1, 0), (0, 1), (0, 0))
Point 0 - Local: (100, 100), Global: (100, 100)
Point 1 - Local: (900, 100), Global: (900, 100)
Point 2 - Local: (900, 500), Global: (900, 500)
Point 3 - Local: (100, 500), Global: (100, 500)
Note: Rect2.expand() did not change bounds for point (100, 500) - this is normal for some polygon arrangements
Raw calculated bounds: (100, 100, 800, 400)
Bounds after margin adjustment: (99, 99, 802, 402)
Final corrected bounds: (99, 99, 802, 402)
========== BOUNDS CALCULATION COMPLETED ==========

Viewport-aware height calculation: 952 * 0.3 = 285.6
Final district bounds: (99, 99, 802, 402)
========== DISTRICT BOUNDS CALCULATION COMPLETED ==========

âœ“ PASS: Camera Calculates Bounds: Camera should calculate bounds from walkable areas
Running test: Bounds Contain Walkable Areas

========== DISTRICT BOUNDS CALCULATION STARTED ==========
Background dimensions: (1000, 600)
Screen size: (1424, 952)
Current camera zoom: (1, 1)
Number of walkable areas: 1

========== BOUNDS CALCULATION STARTED ==========
Number of walkable areas: 1
Using get_polygon() interface method
Processing walkable area: WalkableArea with 4 points
Area transform: ((1, 0), (0, 1), (0, 0))
Point 0 - Local: (100, 100), Global: (100, 100)
Point 1 - Local: (900, 100), Global: (900, 100)
Point 2 - Local: (900, 500), Global: (900, 500)
Point 3 - Local: (100, 500), Global: (100, 500)
Note: Rect2.expand() did not change bounds for point (100, 500) - this is normal for some polygon arrangements
Raw calculated bounds: (100, 100, 800, 400)
Bounds after margin adjustment: (99, 99, 802, 402)
Final corrected bounds: (99, 99, 802, 402)
========== BOUNDS CALCULATION COMPLETED ==========

Viewport-aware height calculation: 952 * 0.3 = 285.6
Final district bounds: (99, 99, 802, 402)
========== DISTRICT BOUNDS CALCULATION COMPLETED ==========

âœ“ PASS: Bounds Contain Walkable Areas: Camera bounds should contain all walkable area points
Running test: Bounds Update on District Change

========== DISTRICT BOUNDS CALCULATION STARTED ==========
Background dimensions: (1000, 600)
Screen size: (1424, 952)
Current camera zoom: (1, 1)
Number of walkable areas: 1

========== BOUNDS CALCULATION STARTED ==========
Number of walkable areas: 1
Using get_polygon() interface method
Processing walkable area: WalkableArea with 4 points
Area transform: ((1, 0), (0, 1), (0, 0))
Point 0 - Local: (200, 200), Global: (200, 200)
Point 1 - Local: (800, 200), Global: (800, 200)
Point 2 - Local: (800, 400), Global: (800, 400)
Point 3 - Local: (200, 400), Global: (200, 400)
Note: Rect2.expand() did not change bounds for point (200, 400) - this is normal for some polygon arrangements
Raw calculated bounds: (200, 200, 600, 200)
Bounds after margin adjustment: (199, 199, 602, 202)
Final corrected bounds: (199, 199, 602, 202)
========== BOUNDS CALCULATION COMPLETED ==========

Viewport-aware height calculation: 952 * 0.3 = 285.6
INFO: Walkable area height is 202 pixels
This is normal for floor-based walkable areas
Adjusting camera height bounds to 285.6 pixels for better visibility
Height-to-viewport ratio: 0.3 (30%)
This preserves the exact floor walkable area while improving camera view
NOTE: Walkable area is much smaller than background.
This is often intentional for floor-based walkable areas.
Using the exact walkable area as specified in the coordinates.
Final district bounds: (199, 157.199997, 602, 285.600006)
========== DISTRICT BOUNDS CALCULATION COMPLETED ==========

[CAMERA DEBUG] CoordinateManager singleton not available for registration
âœ“ PASS: Bounds Update on District Change: Camera bounds should update when walkable areas change
Suite completed: 3/3 tests passed
Running test suite: camera_constraint with timeout protection
===== TEST SUITE: Camera Constraint =====
Running test: Camera Stays Within Bounds
ensure_valid_target called with position: (2000, 2000)
Current test_mode value: False
Camera half size: (712, 476)
WARNING: Camera width exceeds bounds width. Centering camera horizontally.
WARNING: Camera height exceeds bounds height. Centering camera vertically.
Position adjusted by bounds: (2000, 2000) -> (500, 300)
Position adjusted by bounds validator: (2000, 2000) -> (500, 300)
move_to_position called with pos=(2000, 2000), immediate=True
Target position after validation: (500, 300)
Immediate move from (500, 300) to (500, 300)
ensure_valid_target called with position: (500, 300)
Current test_mode value: False
Camera half size: (712, 476)
WARNING: Camera width exceeds bounds width. Centering camera horizontally.
WARNING: Camera height exceeds bounds height. Centering camera vertically.
move_to_position called with pos=(500, 300), immediate=True
Target position after validation: (500, 300)
Immediate move from (500, 300) to (500, 300)
âœ“ PASS: Camera Stays Within Bounds: Camera should stay within calculated bounds
Running test: Camera Handles Invalid Targets
WARNING: Camera: Invalid coordinate detected (NaN). Using camera position as fallback.
     at: call (modules/gdscript/gdscript_functions.cpp:789)
ensure_valid_target called with position: (nan, 100)
Current test_mode value: False
Camera half size: (712, 476)
WARNING: Camera width exceeds bounds width. Centering camera horizontally.
WARNING: Camera height exceeds bounds height. Centering camera vertically.
move_to_position called with pos=(nan, 100), immediate=True
Target position after validation: (500, 300)
Immediate move from (500, 300) to (500, 300)
ensure_valid_target called with position: (500, 300)
Current test_mode value: False
Camera half size: (712, 476)
WARNING: Camera width exceeds bounds width. Centering camera horizontally.
WARNING: Camera height exceeds bounds height. Centering camera vertically.
move_to_position called with pos=(500, 300), immediate=True
Target position after validation: (500, 300)
Immediate move from (500, 300) to (500, 300)
âœ“ PASS: Camera Handles Invalid Targets: Camera should handle invalid target positions
Running test: Camera Uses BoundsCalculator

========== DISTRICT BOUNDS CALCULATION STARTED ==========
Background dimensions: (1000, 600)
Screen size: (1424, 952)
Current camera zoom: (1, 1)
Number of walkable areas: 2

========== BOUNDS CALCULATION STARTED ==========
Number of walkable areas: 2
Using get_polygon() interface method
Processing walkable area: WalkableArea with 4 points
Area transform: ((1, 0), (0, 1), (0, 0))
Point 0 - Local: (100, 100), Global: (100, 100)
Point 1 - Local: (900, 100), Global: (900, 100)
Point 2 - Local: (900, 500), Global: (900, 500)
Point 3 - Local: (100, 500), Global: (100, 500)
Note: Rect2.expand() did not change bounds for point (100, 500) - this is normal for some polygon arrangements
Using get_polygon() interface method
Processing walkable area: @WalkableArea@3 with 4 points
Area transform: ((1, 0), (0, 1), (0, 0))
Point 0 - Local: (0, 0), Global: (0, 0)
Point 1 - Local: (1000, 0), Global: (1000, 0)
Point 2 - Local: (1000, 600), Global: (1000, 600)
Point 3 - Local: (0, 600), Global: (0, 600)
Note: Rect2.expand() did not change bounds for point (0, 600) - this is normal for some polygon arrangements
Raw calculated bounds: (0, 0, 1000, 600)
Bounds after margin adjustment: (-1, -1, 1002, 602)
Final corrected bounds: (-1, -1, 1002, 602)
========== BOUNDS CALCULATION COMPLETED ==========

Viewport-aware height calculation: 952 * 0.3 = 285.6
Final district bounds: (-1, -1, 1002, 602)
========== DISTRICT BOUNDS CALCULATION COMPLETED ==========

âœ“ PASS: Camera Uses BoundsCalculator: Camera should use BoundsCalculator to calculate bounds
Suite completed: 3/3 tests passed
Running test suite: coordinate_transformations with timeout protection
===== TEST SUITE: Coordinate Transformations =====
Running test: Screen to World with Camera
âœ“ PASS: Screen to World with Camera: Screen-to-world conversion should map screen center to camera position
Running test: World to Screen with Camera
âœ“ PASS: World to Screen with Camera: World-to-screen conversion should map camera position to screen center
Running test: District Camera Coordinate Methods Match
âœ“ PASS: District Camera Coordinate Methods Match: District and camera coordinate methods should give consistent results
Suite completed: 3/3 tests passed
Running test suite: view_modes with timeout protection
===== TEST SUITE: View Modes =====
Running test: World View Coordinate Transformations
âœ“ PASS: World View Coordinate Transformations: World view coordinates should be properly transformed to game view
Running test: Game View Coordinate Transformations
âœ“ PASS: Game View Coordinate Transformations: Game view coordinates should be properly transformed to world view
Running test: View Mode Transformation Consistency
âœ“ PASS: View Mode Transformation Consistency: View mode transformations should be consistent when applied bidirectionally
Suite completed: 3/3 tests passed
Running test suite: player_movement with timeout protection
===== TEST SUITE: Player Movement =====
Running test: Camera Follows Player Movement
Setting target_player to: MockPlayer:[Node2D:1310]
[CAMERA DEBUG] Camera state changed from IDLE to FOLLOWING_PLAYER
Running test: Camera Stops at Boundaries
Setting target_player to: MockPlayer:[Node2D:1310]
Running test: Player Stays Within Walkable Areas
âœ“ PASS: Player Stays Within Walkable Areas: Walkable area detection should correctly identify valid positions
Suite completed: 1/1 tests passed
All tests completed.

===== TEST RESULTS =====
Total Tests: 13
Passed: 13
Failed: 0

All tests passed! ðŸŽ‰
Tests complete - exiting...
[CAMERA DEBUG] CoordinateManager singleton not available for registration
ERROR: Resumed function '_ready()' after yield, but script is gone. At script: res://src/core/camera/scrolling_camera.gd:441
   at: resume (modules/gdscript/gdscript_function.cpp:1795)

=== Component Test: coordinate_transformation_component_test ===
Exit code: 0
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized
Setting up Coordinate Transformation component test...
ScrollingCamera._ready() called - Script Path: res://src/core/camera/scrolling_camera.gd
ScrollingCamera class loaded - Script ID: 1304
[TRACE] Camera initialized with screen size: (1424, 952)
Debug drawing is disabled
No target player set
Test scene created with district and camera
Starting Coordinate Transformation component tests...
Running test suite: screen_world_transformations with timeout protection
===== TEST SUITE: Screen World Transformations =====
Running test: Scrolling Camera Screen to World
âœ“ PASS: Scrolling Camera Screen to World: Camera screen_to_world should map screen center to camera position
Running test: Scrolling Camera World to Screen
âœ“ PASS: Scrolling Camera World to Screen: Camera world_to_screen should map camera position to screen center
Running test: CoordinateSystem Screen to World
âœ“ PASS: CoordinateSystem Screen to World: CoordinateSystem screen_to_world should map screen center to camera position
Running test: CoordinateSystem World to Screen
âœ“ PASS: CoordinateSystem World to Screen: CoordinateSystem world_to_screen should map camera position to screen center
Running test: District Coordinate Methods
âœ“ PASS: District Coordinate Methods: District coordinate methods should use camera methods correctly
Suite completed: 5/5 tests passed
Running test suite: game_world_view_transformations with timeout protection
===== TEST SUITE: Game World View Transformations =====
Running test: CoordinateSystem World to Game
âœ“ PASS: CoordinateSystem World to Game: world_view_to_game_view should divide coordinates by scale factor
Running test: CoordinateSystem Game to World
âœ“ PASS: CoordinateSystem Game to World: game_view_to_world_view should multiply coordinates by scale factor
Running test: CoordinateManager View Transformations
CoordinateManager initialized
âœ“ PASS: CoordinateManager View Transformations: CoordinateManager view transformations should work correctly in both directions
Running test: Scale Factor Handling
âœ“ PASS: Scale Factor Handling: Scale factor operations should work correctly with different factors
Suite completed: 4/4 tests passed
Running test suite: round_trip_transformations with timeout protection
===== TEST SUITE: Round Trip Transformations =====
Running test: Screen World Round Trip
âœ“ PASS: Screen World Round Trip: Screen-to-world-to-screen round trip should preserve coordinates
Running test: Game World View Round Trip
âœ“ PASS: Game World View Round Trip: Game-view-to-world-view-to-game-view round trip should preserve coordinates
Running test: Full Coordinate Pipeline
CoordinateManager initialized
âœ“ PASS: Full Coordinate Pipeline: Full coordinate transformation pipeline should preserve coordinates
Suite completed: 3/3 tests passed
Running test suite: coordinate_systems_integration with timeout protection
===== TEST SUITE: Coordinate Systems Integration =====
Running test: Camera CoordinateSystem Consistency
âœ“ PASS: Camera CoordinateSystem Consistency: Camera and CoordinateSystem methods should give consistent results
Running test: District CoordinateManager Consistency
CoordinateManager initialized
âœ“ PASS: District CoordinateManager Consistency: District and CoordinateManager methods should give consistent results
Running test: Cross System Transformations
CoordinateManager initialized
Cross-system transformation difference: 0 pixels
âœ“ PASS: Cross System Transformations: Coordinate transformations should work consistently across different systems
Suite completed: 3/3 tests passed
Running test suite: edge_cases with timeout protection
===== TEST SUITE: Edge Cases =====
Running test: Handle NaN Values
WARNING: world_view_to_game_view received NaN coordinates: (nan, 100)
WARNING: world_view_to_game_view received NaN coordinates: (100, nan)
WARNING: world_view_to_game_view received NaN coordinates: (nan, nan)
WARNING: Camera: Invalid coordinate detected (NaN). Using camera position as fallback.
     at: call (modules/gdscript/gdscript_functions.cpp:789)
WARNING: Camera: Invalid coordinate detected (NaN). Using camera position as fallback.
     at: call (modules/gdscript/gdscript_functions.cpp:789)
WARNING: Camera: Invalid coordinate detected (NaN). Using camera position as fallback.
     at: call (modules/gdscript/gdscript_functions.cpp:789)
âœ“ PASS: Handle NaN Values: Coordinate systems should properly handle NaN values
Running test: Handle Infinity Values
WARNING: Camera: Invalid coordinate detected (Infinite). Using camera position as fallback.
     at: call (modules/gdscript/gdscript_functions.cpp:789)
WARNING: Camera: Invalid coordinate detected (Infinite). Using camera position as fallback.
     at: call (modules/gdscript/gdscript_functions.cpp:789)
WARNING: Camera: Invalid coordinate detected (Infinite). Using camera position as fallback.
     at: call (modules/gdscript/gdscript_functions.cpp:789)
âœ“ PASS: Handle Infinity Values: Coordinate systems should properly handle infinity values
Running test: Handle Large Coordinates
WARNING: Camera: Suspiciously large coordinate detected. Using camera position as fallback.
     at: call (modules/gdscript/gdscript_functions.cpp:789)
[CAMERA DEBUG] Large coordinate detected: (1000000, 1000000)
WARNING: Camera: Suspiciously large coordinate detected. Using camera position as fallback.
     at: call (modules/gdscript/gdscript_functions.cpp:789)
[CAMERA DEBUG] Large coordinate detected: (-1000000, 1000000)
WARNING: Camera: Suspiciously large coordinate detected. Using camera position as fallback.
     at: call (modules/gdscript/gdscript_functions.cpp:789)
[CAMERA DEBUG] Large coordinate detected: (1000000, -1000000)
âœ“ PASS: Handle Large Coordinates: Coordinate systems should properly handle very large coordinates
Running test: Handle Negative Coordinates
âœ“ PASS: Handle Negative Coordinates: Coordinate systems should properly handle negative coordinates
Suite completed: 4/4 tests passed
Running test suite: performance with timeout protection
===== TEST SUITE: Performance =====
Running test: Batch Transformations
Batch transformation time for 100 points: 0ms
âœ“ PASS: Batch Transformations: Batch transformations should complete without errors
Running test: Large Array Transformations
CoordinateManager initialized
Large array transformation time for 1000 points: 2ms
âœ“ PASS: Large Array Transformations: Large array transformations should preserve array size
Suite completed: 2/2 tests passed
All tests completed.

===== TEST RESULTS =====
Total Tests: 21
Passed: 21
Failed: 0

All tests passed! ðŸŽ‰
Tests complete - exiting...
[CAMERA DEBUG] CoordinateManager singleton not available for registration
ERROR: Resumed function '_ready()' after yield, but script is gone. At script: res://src/core/camera/scrolling_camera.gd:441
   at: resume (modules/gdscript/gdscript_function.cpp:1795)

=== Component Test: navigation_oscillation_component_test ===
Exit code: 0
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized
Setting up Navigation Oscillation component test...
Creating test scene...

===== RUNNING INTEGRATION TESTS =====


=== Test Suite: Corner Navigation ===
Player linked to district: Navigation Test District

[TEST] sharp_corner_oscillation
Testing navigation from (300, 380) to (220, 500)
Moving to: (220, 500)
Test scene created successfully
  Time: 0.5, Pos: (260.665405, 395), Dist to target: 112.6
  Time: 1.0, Pos: (235.960114, 395), Dist to target: 106.2
  OSCILLATION DETECTED at (229.347595, 404.940338) (count: 3)
  Time: 1.5, Pos: (222.171097, 477.921417), Dist to target: 22.2
  âœ“ PASS: Player successfully navigated corner

=== Test Suite: Narrow Corridor ===

[TEST] narrow_corridor_oscillation
Testing narrow corridor navigation to corner junction
Moving to: (220, 420)
  OSCILLATION DETECTED at (171.609604, 392.348328) (count: 3)
  Time: 0.5, Pos: (213.257263, 412.383698), Dist to target: 10.2
  âœ“ PASS: Player successfully navigated narrow corridor

=== Test Suite: Boundary Interaction ===

[TEST] boundary_pushback_oscillation
Testing boundary pushback near corner
Moving to: (220, 410)
  âœ“ PASS: Player navigated smoothly with minimal pushback

===== TEST RESULTS =====
Total tests: 3
Passed: 3
Failed: 0
Tests complete - exiting...
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:179
   at: resume (modules/gdscript/gdscript_function.cpp:1802)

=== Component Test: navigation_pathfinding_component_test ===
Exit code: 0
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized

==================================================
 NAVIGATIONPATHFINDINGCOMPONENTTEST TEST SUITE
==================================================

Player linked to district: Test District

===== TEST SUITE: Navigation Setup Tests =====

[TEST] test_player_finds_navigation_node
  âœ“ PASS: test_player_finds_navigation_node: Player can find navigation node in parent hierarchy

[TEST] test_navigation2d_setup
  âœ“ PASS: test_navigation2d_setup: Navigation2D and NavigationPolygon are properly configured

[TEST] test_district_navigation_reference
  âœ“ PASS: test_district_navigation_reference: District has correct navigation reference

===== TEST SUITE: Pathfinding Tests =====

[TEST] test_get_simple_path
WARNING: 'Navigation2D' node and 'Navigation2D.get_simple_path()' are deprecated and will be removed in a future version. Use 'Navigation2DServer.map_get_path()' instead.
     at: get_simple_path (scene/2d/navigation_2d.cpp:81)
  âœ“ PASS: test_get_simple_path: Navigation2D returns valid path with at least 2 points

[TEST] test_path_within_bounds
  âœ“ PASS: test_path_within_bounds: All path points stay within navigation polygon bounds

[TEST] test_path_to_unreachable
  âœ“ PASS: test_path_to_unreachable: Pathfinding handles unreachable destinations correctly

===== TEST SUITE: Path Following Tests =====

[TEST] test_player_path_request
  âœ“ PASS: test_player_path_request: Player can request and store navigation path

[TEST] test_movement_state_with_navigation
Moving to: (200, 150)
  âœ“ PASS: test_movement_state_with_navigation: Player enters correct movement state when following path

[TEST] test_path_following_movement
Moving to: (150, 50)
  âœ“ PASS: test_path_following_movement: Player position updates when following path

===== TEST SUITE: Obstacle Avoidance Tests =====

[TEST] test_path_avoids_obstacle
  âœ“ PASS: test_path_avoids_obstacle: Skipping - Godot 3.5.2 Navigation2D hole handling has known limitations

===== TEST SUITE: Fallback Behavior Tests =====

[TEST] test_fallback_to_direct_movement
Moving to: (200, 150)
  âœ“ PASS: test_fallback_to_direct_movement: Player falls back to direct movement when navigation unavailable

[TEST] test_walkable_validation_with_navigation
Cannot move to: (500, 500) - not in walkable area
  âœ“ PASS: test_walkable_validation_with_navigation: Movement still validates against walkable areas

==================================================
 SUMMARY: 12 passed, 0 failed
==================================================

[PASS] All NavigationPathfindingComponentTest tests passed!

=== Component Test: player_navigation_progress_component_test ===
Exit code: 0
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized

==================================================
 PLAYERNAVIGATIONPROGRESSCOMPONENTTEST TEST SUITE
==================================================


[TEST] test_player_makes_progress_along_path
  Start position: (975, 150)
  End position: (900, 375)
  Total distance traveled: 539.93
  Final waypoint index: 0
  Current state: ARRIVED
  âœ“ PASS: test_player_makes_progress_along_path: Player should make progress along navigation path
Player linked to district: Test District
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:179
   at: resume (modules/gdscript/gdscript_function.cpp:1802)

[TEST] test_waypoint_reaching_with_overshoot
  Player position after movement: (115.884789, 100)
  Distance to waypoint: 4.12
  Waypoint index advanced: True
  âœ“ PASS: test_waypoint_reaching_with_overshoot: Player should advance waypoint even with slight overshoot
Player linked to district: Test District

[TEST] test_navigation_stuck_at_intermediate_waypoint
  Start position: (975, 150)
  End position: (834.025085, 366.37207)
  Final waypoint: 3 of 3
  Final state: MOVING
  Made progress: True
  Got stuck: False
  Reached destination: True
  âœ“ PASS: test_navigation_stuck_at_intermediate_waypoint: Player should navigate around obstacles without getting stuck
Player linked to district: Test District

[TEST] test_velocity_direction_mismatch_handling
  Waypoint transition 0 -> 1
    Position: (808.092896, 200.157349)
    Velocity: (167.407196, 9.834524) (magnitude: 167.70)
    State: MOVING
    Velocity dot with new direction: 0.08
  Waypoint transition 1 -> 2
    Position: (810.292236, 299.742188)
    Velocity: (-46.690575, 192.979538) (magnitude: 198.55)
    State: MOVING
    Velocity dot with new direction: 0.97
  First transition velocity: (167.407196, 9.834524)
  Second transition velocity: (-46.690575, 192.979538)
  Final position: (809.860901, 382.783752)
  Target reached: True
  âœ“ PASS: test_velocity_direction_mismatch_handling: Player should handle sharp turns at waypoints without getting stuck
Player linked to district: Test District

[TEST] test_waypoint_index_reset_bug
  Waypoint index changed: 0 -> 1 at position (199.711929, 100)
  Distance to final target: 200.29
  Waypoint index changed: 1 -> 2 at position (298.912048, 100)
  Distance to final target: 101.09
  Waypoint index changed: 2 -> 3 at position (394.912415, 100)
  Distance to final target: 5.09
  Indices visited: [0, 1, 2, 3]
  Sequential: True
  Index reset detected: False
  Final position: (400, 100)
  Final state: ARRIVED
  âœ“ PASS: test_waypoint_index_reset_bug: Waypoints should be followed sequentially without resetting to 0
Player linked to district: Test District

==================================================
 SUMMARY: 5 passed, 0 failed
==================================================

[PASS] All PlayerNavigationProgressComponentTest tests passed!
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:179
   at: resume (modules/gdscript/gdscript_function.cpp:1802)

=== Component Test: player_navigation_stuck_component_test ===
Exit code: 0
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized

==================================================
 PLAYERNAVIGATIONSTUCKCOMPONENTTEST TEST SUITE
==================================================

Player linked to district: Test Navigation District

===== TEST SUITE: Coordinate Consistency Tests =====

[TEST] test_position_vs_global_position
  âœ“ PASS: test_position_vs_global_position: Player should move when using consistent coordinates

[TEST] test_navigation_path_coordinate_space
WARNING: 'Navigation2D' node and 'Navigation2D.get_simple_path()' are deprecated and will be removed in a future version. Use 'Navigation2DServer.map_get_path()' instead.
     at: get_simple_path (scene/2d/navigation_2d.cpp:81)
  âœ“ PASS: test_navigation_path_coordinate_space: Navigation path should be in player's coordinate space

===== TEST SUITE: Waypoint Reaching Tests =====

[TEST] test_waypoint_threshold
  Distance to waypoint: 9.487999
  âœ“ PASS: test_waypoint_threshold: Waypoint threshold test completed (threshold behavior documented)

[TEST] test_waypoint_sequential_following
  Indices visited: [0, 1, 2, 3]
  Final path index: 0
  âœ“ PASS: test_waypoint_sequential_following: Waypoints should be followed sequentially

===== TEST SUITE: Path Following Stability Tests =====

[TEST] test_high_speed_stability
  âœ“ PASS: test_high_speed_stability: Player should not oscillate at high speeds

[TEST] test_eventual_arrival
  Frames to arrive: 38
  Final distance: 0.000000
  Final state: ARRIVED
  âœ“ PASS: test_eventual_arrival: Player should eventually arrive at destination

===== TEST SUITE: Deceleration Recovery Tests =====

[TEST] test_deceleration_recovery
  State transitions: [DECELERATING, ACCELERATING, MOVING]
  âœ“ PASS: test_deceleration_recovery: Player should recover from DECELERATING state when target not reached

[TEST] test_stuck_detection
  Distance traveled in 1 second: 182.960526
  State changes: 1
  Final state: MOVING
  âœ“ PASS: test_stuck_detection: Player should not get stuck oscillating between states

==================================================
 SUMMARY: 8 passed, 0 failed
==================================================

[PASS] All PlayerNavigationStuckComponentTest tests passed!
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:179
   at: resume (modules/gdscript/gdscript_function.cpp:1802)
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:179
   at: resume (modules/gdscript/gdscript_function.cpp:1802)

=== Component Test: view_mode_transition_component_test ===
Exit code: 0
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized
Setting up View Mode Transition component test...
Master timeout set for 30 seconds
ScrollingCamera._ready() called - Script Path: res://src/core/camera/scrolling_camera.gd
ScrollingCamera class loaded - Script ID: 1305
[TRACE] Camera initialized with screen size: (1424, 952)
Debug drawing is disabled
No target player set
ERROR: Can't add child 'MockDebugManager' to 'ViewModeTransitionTest', already has a parent 'ViewModeTransitionTest'.
   at: add_child (scene/main/node.cpp:1282)
Test scene created with district, camera, and debug manager
[CAMERA DEBUG] CoordinateManager singleton not available for registration
WARNING: ScrollingCamera could not find a player node
Using default camera bounds based on screen size
Initializing DefaultBoundsValidator with bounds: (0, 0, 1424, 952)
BoundsValidator initialized: Reference

===== CAMERA INITIAL POSITION SETUP =====
Current camera position: (500, 300)
Initial position setting: (0, 0)
Initial view setting: right
Screen size: (1424, 952)

===== CALCULATING OPTIMAL ZOOM =====
Could not find background information - camera zoom unchanged
===== ZOOM CALCULATION COMPLETE =====

Camera half size (screen size / 2 / zoom): (712, 476)
Camera bounds: (0, 0, 1424, 952)
Background wide enough for scrolling: False
Background width: 1424, Min width for scrolling: 2136
Using RIGHT initial view setting
Centering camera on walkable area: (712, 476)
Setting camera position to: (712, 476)
Camera position after setting: (712, 476)
[CAMERA DEBUG] Checking camera position against walkable area center
Camera positioned for initial view: right at (712, 476)
View ratio: 100% of background is visible (1424 pixels of 1424 pixels)
===== CAMERA INITIAL POSITION SETUP COMPLETE =====

[CAMERA DEBUG] Camera initialized in IDLE state
Starting View Mode Transition component tests...
Running suite: View Mode Switching
===== TEST SUITE: View Mode Switching =====
Running test: Toggle World View Mode
WARNING: Missing suite in test_results: Toggle. Creating it now.
âœ“ PASS: Toggle World View Mode: Camera world_view_mode should be toggleable
Running test: Game to World View Transition
WARNING: Missing suite in test_results: Game. Creating it now.
âœ“ PASS: Game to World View Transition: World view mode flag can be toggled without errors
Running test: World to Game View Transition
Setting target_player to: TempPlayer:[Node2D:1325]
[CAMERA DEBUG] Camera state changed from IDLE to FOLLOWING_PLAYER
Setting target_player to: Null
WARNING: Setting target_player to null
WARNING: Missing suite in test_results: World. Creating it now.
âœ“ PASS: World to Game View Transition: Transitioning from world view to game view can enable player following
Suite completed: 1/1 tests passed
Running suite: Camera View Mode Behavior
===== TEST SUITE: Camera View Mode Behavior =====
Running test: Camera Zoom in World View
WARNING: Missing suite in test_results: Camera. Creating it now.
âœ“ PASS: Camera Zoom in World View: Camera zoom can be changed in world view mode
Running test: Camera Bounds in World View
âœ“ PASS: Camera Bounds in World View: Camera bounds behavior should be consistent in world view mode
Running test: Player Following in World View
Setting target_player to: MockPlayer:[Node2D:1344]
WARNING: Missing suite in test_results: Player. Creating it now.
âœ“ PASS: Player Following in World View: Camera should not follow player in world view mode
Suite completed: 1/1 tests passed
Running suite: Coordinate Transformations
===== TEST SUITE: Coordinate Transformations =====
Running test: Screen to World in View Modes
WARNING: Missing suite in test_results: Screen. Creating it now.
âœ“ PASS: Screen to World in View Modes: Screen-to-world coordinates can be obtained in both view modes
Running test: World to Screen in View Modes
âœ“ PASS: World to Screen in View Modes: World-to-screen coordinates should return valid results in both view modes
Running test: Coordinate Transformations During Transition
CoordinateManager initialized
CoordinateManager: Applied scale factor 2 to world position: (-224, -152)
WARNING: Missing suite in test_results: Coordinate. Creating it now.
âœ“ PASS: Coordinate Transformations During Transition: Coordinate transformations should respect scale factor during view mode transitions
Suite completed: 1/1 tests passed
Running suite: View Mode Detection
===== TEST SUITE: View Mode Detection =====
Running test: Detect View Mode from Debug
WARNING: CoordinateSystem class not found, skipping test
WARNING: Missing suite in test_results: Detect. Creating it now.
âœ“ PASS: Detect View Mode from Debug: CoordinateSystem should correctly detect world view mode from debug manager
Running test: CoordinateSystem View Mode Detection
WARNING: CoordinateSystem class not found, skipping test
âœ“ PASS: CoordinateSystem View Mode Detection: CoordinateSystem should correctly detect view mode in all cases
Running test: CoordinateManager View Mode Detection
CoordinateManager initialized
DEBUG: Detected World View mode via full_view_mode property
CoordinateManager: View mode changed to WORLD_VIEW
âœ“ PASS: CoordinateManager View Mode Detection: CoordinateManager should correctly detect world view mode from debug manager
Suite completed: 3/3 tests passed
Running suite: Debug Manager Integration
===== TEST SUITE: Debug Manager Integration =====
Running test: Debug Manager Controls View Mode
WARNING: Missing suite in test_results: Debug. Creating it now.
âœ“ PASS: Debug Manager Controls View Mode: Camera view mode should be controllable by debug manager
Running test: Debug Indicators in View Modes
Setting debug_draw to: True
[OVERLAY DEBUG] Created debug overlay
Setting debug_draw to: False
âœ“ PASS: Debug Indicators in View Modes: Debug indicators should handle view mode transitions without errors
Running test: Debug Coordinate Picker in View Modes
âœ“ PASS: Debug Coordinate Picker in View Modes: Debug coordinate picker should record the correct view mode
Suite completed: 3/3 tests passed
All tests completed.

===== TEST RESULTS =====
Total Tests: 15
Passed: 15
Failed: 0

All tests passed! ðŸŽ‰
Master timeout cancelled - tests completed normally

