=== Component Test: input_coordinate_component_test ===
Exit code: 0
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized
Unknown District loaded
CoordinateManager: Current district set to Unknown District
Registered district with CoordinateManager

==================================================
 INPUTCOORDINATECOMPONENTTEST COMPONENT TEST SUITE
==================================================

Test Input Coordinate District loaded
CoordinateManager: Current district set to Test Input Coordinate District
Registered district with CoordinateManager
Setting debug_draw to: True
ScrollingCamera._ready() called - Script Path: res://src/core/camera/scrolling_camera.gd
ScrollingCamera class loaded - Script ID: 1314
[TRACE] Camera initialized with screen size: (1424, 952)
[OVERLAY DEBUG] Created debug overlay
No target player set
Added scrolling camera to Test Input Coordinate District with initial view: right
CoordinateManager: Current district set to Test Input Coordinate District
[CAMERA DEBUG] CoordinateManager singleton not available for registration
WARNING: ScrollingCamera could not find a player node

========== DISTRICT BOUNDS CALCULATION STARTED ==========
Background dimensions: (2400, 1800)
Screen size: (1424, 952)
Current camera zoom: (1, 1)
Number of walkable areas: 0

========== BOUNDS CALCULATION STARTED ==========
Number of walkable areas: 0
WARNING: No valid walkable areas found, using default bounds
Raw calculated bounds: (0, 0, 800, 600)
Bounds after margin adjustment: (-1, -1, 802, 602)
Final corrected bounds: (-1, -1, 802, 602)
========== BOUNDS CALCULATION COMPLETED ==========

Viewport-aware height calculation: 952 * 0.3 = 285.6
NOTE: Walkable area is much smaller than background.
This is often intentional for floor-based walkable areas.
Using the exact walkable area as specified in the coordinates.
Final district bounds: (-1, -1, 802, 602)
========== DISTRICT BOUNDS CALCULATION COMPLETED ==========

Camera bounds set from district: (-1, -1, 802, 602)
Initializing DefaultBoundsValidator with bounds: (-1, -1, 802, 602)
BoundsValidator initialized: Reference

===== CAMERA INITIAL POSITION SETUP =====
Current camera position: (0, 0)
Initial position setting: (0, 0)
Initial view setting: right
Screen size: (1424, 952)

===== CALCULATING OPTIMAL ZOOM =====
Found background sprite with texture size: (2400, 1800)
Current background scale: (1, 1)
Effective background size with current scale: (2400, 1800)
Scale needed to fill viewport height: 0.528889
Applied new scale to background: (0.528889, 0.528889)
[SCALING DEBUG] Background vertical positioning applied:
[SCALING DEBUG] - Viewport height: 952
[SCALING DEBUG] - Scaled background height: 952
[SCALING DEBUG] - Applied y_offset: 0
New effective background size: (1269.333374, 952)
Camera zoom left at 1.0 (since we're scaling the background)
Updated district.background_size to (1269.333374, 952)
Updated camera bounds to match scaled background for visual correctness: (0, 0, 1269.333374, 952)
Updated bounds validator with new camera bounds
===== ZOOM CALCULATION COMPLETE =====

Camera half size (screen size / 2 / zoom): (712, 476)
Camera bounds: (0, 0, 1269.333374, 952)
Background wide enough for scrolling: False
Background width: 1269.333374, Min width for scrolling: 2136
Using RIGHT initial view setting
Centering camera on walkable area: (634.666687, 476)
Setting camera position to: (634.666687, 476)
Camera position after setting: (635, 476)
[CAMERA DEBUG] Checking camera position against walkable area center
Camera positioned for initial view: right at (635, 476)
View ratio: 112% of background is visible (1424 pixels of 1269.333374 pixels)
===== CAMERA INITIAL POSITION SETUP COMPLETE =====

[CAMERA DEBUG] Camera initialized in IDLE state

===== TEST SUITE: Basic Coordinate Conversion =====

[TEST] test_click_converts_to_world
Added standard player character at position (960, 540)
Setting target_player to: @Player@4:[Node2D:1343]
[CAMERA DEBUG] Camera state changed from IDLE to FOLLOWING_PLAYER
Camera set to follow player
Added standard player controller for point-and-click navigation
  Captured world position: (-312, -176)
Player linked to district: Test Input Coordinate District
Player controller initialized
  Screen click: (400, 300)
  Expected world: (-312, -176)
  Actual world: (-312, -176)
  Distance: 0.00
  ✓ PASS: test_click_converts_to_world: Screen coordinates correctly converted to world coordinates

===== TEST SUITE: Different Camera States =====

[TEST] test_conversion_with_camera_offset
  Captured world position: (748, 364)
  Camera offset: (500, 300)
  Screen click: (960, 540)
  Expected world: (748, 364)
  Actual world: (748, 364)
  ✓ PASS: test_conversion_with_camera_offset: Conversion accounts for camera offset

[TEST] test_conversion_with_camera_zoom
  Captured world position: (-116, -103)
  Camera zoom: (0.5, 0.5)
  Screen click: (480, 270)
  Expected world: (-116, -103)
  Actual world: (-116, -103)
  ✓ PASS: test_conversion_with_camera_zoom: Conversion accounts for camera zoom

===== TEST SUITE: Edge Cases =====

[TEST] test_screen_boundary_clicks
  Captured world position: (-712, -476)
  Captured world position: (711, -476)
  Captured world position: (-712, 475)
  Captured world position: (711, 475)
  ✓ PASS: test_screen_boundary_clicks: Screen boundary clicks are converted correctly

[TEST] test_rapid_click_conversion
  Captured world position: (-312, -176)
  Captured world position: (-262, -146)
  Captured world position: (-212, -116)
  Captured world position: (-162, -86)
  Captured world position: (-112, -56)
  Captured world position: (-62, -26)
  Captured world position: (-12, 4)
  Captured world position: (38, 34)
  Captured world position: (88, 64)
  Captured world position: (138, 94)
  ✓ PASS: test_rapid_click_conversion: Rapid clicks are all converted correctly

==================================================
 SUMMARY: 5 passed, 0 failed
==================================================

[PASS] All InputCoordinateComponentTest tests passed!
ERROR: Condition "_first != nullptr" is true.
   at: ~List (./core/self_list.h:108)
ERROR: Condition "_first != nullptr" is true.
   at: ~List (./core/self_list.h:108)
WARNING: ObjectDB instances leaked at exit (run with --verbose for details).
     at: cleanup (core/object.cpp:2070)
ERROR: Resources still in use at exit (run with --verbose for details).
   at: clear (core/resource.cpp:417)

