=== Test: player_coordinate_mismatch_test ===
Exit code: 2
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized

==================================================
 PLAYERCOORDINATEMISMATCHTEST TEST SUITE
==================================================


[TEST] test_position_global_position_mismatch
WARNING: No district found for the player
  Container position: (100, 100)
  Player local position: (50, 50)
  Player global position: (150, 150)
  Expected global position: (150, 150)
  Current target: (200, 150)
  Direction using position: (150, 100)
  Direction using global_position: (50, 0)
  ✗ FAIL: test_position_global_position_mismatch: Player should use same coordinate space regardless of parent position

[TEST] test_waypoint_distance_checks
WARNING: No district found for the player
  Player position: (100, 100)
  Player global_position: (100, 100)
  Waypoint: (110, 100)
  Distance using position: 10.000000
  Distance using global_position: 10.000000
  ✓ PASS: test_waypoint_distance_checks: Distance calculations are consistent when player is at root level

[TEST] test_navigation_direction_calculation_bug
SCRIPT ERROR: Invalid get index 'district_name' (on base: 'Node2D').
          at: _find_current_district (res://src/characters/player/player.gd:49)
  Player position: (875, 50)
  Player global_position: (975, 150)
  Navigation target: (500, 500)
  Wrong direction (using position): (-375, 450)
  Correct direction (using global_position): (-475, 350)
  Wrong distance: 585.768738
  Correct distance: 590.021179
  ✗ FAIL: test_navigation_direction_calculation_bug: Player should use global_position for navigation calculations

==================================================
 SUMMARY: 1 passed, 2 failed
==================================================

[FAIL] Some tests failed!
  - test_position_global_position_mismatch
  - test_navigation_direction_calculation_bug

=== Test: player_navigation_stuck_test ===
Exit code: 3
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized

==================================================
 PLAYERNAVIGATIONSTUCKTEST TEST SUITE
==================================================

Player linked to district: Test Navigation District

===== TEST SUITE: Coordinate Consistency Tests =====

[TEST] test_position_vs_global_position
  ✓ PASS: test_position_vs_global_position: Player should move when using consistent coordinates

[TEST] test_navigation_path_coordinate_space
WARNING: 'Navigation2D' node and 'Navigation2D.get_simple_path()' are deprecated and will be removed in a future version. Use 'Navigation2DServer.map_get_path()' instead.
     at: get_simple_path (scene/2d/navigation_2d.cpp:81)
  ✓ PASS: test_navigation_path_coordinate_space: Navigation path should be in player's coordinate space

===== TEST SUITE: Waypoint Reaching Tests =====

[TEST] test_waypoint_threshold
  Distance to waypoint: 9.487999
  ✓ PASS: test_waypoint_threshold: Waypoint threshold test completed (threshold behavior documented)

[TEST] test_waypoint_sequential_following
  ✗ FAIL: test_waypoint_sequential_following: Waypoints should be followed sequentially

===== TEST SUITE: Path Following Stability Tests =====

[TEST] test_high_speed_stability
  ✓ PASS: test_high_speed_stability: Player should not oscillate at high speeds

[TEST] test_eventual_arrival
  Frames to arrive: 38
  Final distance: 0.000000
  Final state: ARRIVED
  ✗ FAIL: test_eventual_arrival: Player should eventually arrive at destination

===== TEST SUITE: Deceleration Recovery Tests =====

[TEST] test_deceleration_recovery
  State transitions: [DECELERATING]
  ✗ FAIL: test_deceleration_recovery: Player should recover from DECELERATING state when target not reached

[TEST] test_stuck_detection
  Distance traveled in 1 second: 182.960526
  State changes: 0
  Final state: DECELERATING
  ✓ PASS: test_stuck_detection: Player should not get stuck oscillating between states

==================================================
 SUMMARY: 5 passed, 3 failed
==================================================

[FAIL] Some tests failed!
  - test_waypoint_sequential_following
  - test_eventual_arrival
  - test_deceleration_recovery
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:126
   at: resume (modules/gdscript/gdscript_function.cpp:1802)
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:126
   at: resume (modules/gdscript/gdscript_function.cpp:1802)

