=== Test: player_navigation_stuck_test ===
Exit code: 1
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized

==================================================
 PLAYERNAVIGATIONSTUCKTEST TEST SUITE
==================================================

Player linked to district: Test Navigation District

===== TEST SUITE: Coordinate Consistency Tests =====

[TEST] test_position_vs_global_position
  ✓ PASS: test_position_vs_global_position: Player should move when using consistent coordinates

[TEST] test_navigation_path_coordinate_space
WARNING: 'Navigation2D' node and 'Navigation2D.get_simple_path()' are deprecated and will be removed in a future version. Use 'Navigation2DServer.map_get_path()' instead.
     at: get_simple_path (scene/2d/navigation_2d.cpp:81)
  ✓ PASS: test_navigation_path_coordinate_space: Navigation path should be in player's coordinate space

===== TEST SUITE: Waypoint Reaching Tests =====

[TEST] test_waypoint_threshold
  Distance to waypoint: 9.487999
  ✓ PASS: test_waypoint_threshold: Waypoint threshold test completed (threshold behavior documented)

[TEST] test_waypoint_sequential_following
  Indices visited: [0, 1, 2, 3, 0]
  Final path index: 0
  ✗ FAIL: test_waypoint_sequential_following: Waypoints should be followed sequentially

===== TEST SUITE: Path Following Stability Tests =====

[TEST] test_high_speed_stability
  ✓ PASS: test_high_speed_stability: Player should not oscillate at high speeds

[TEST] test_eventual_arrival
  Frames to arrive: 38
  Final distance: 0.000000
  Final state: ARRIVED
  ✓ PASS: test_eventual_arrival: Player should eventually arrive at destination

===== TEST SUITE: Deceleration Recovery Tests =====

[TEST] test_deceleration_recovery
  State transitions: [DECELERATING, ACCELERATING, MOVING]
  ✓ PASS: test_deceleration_recovery: Player should recover from DECELERATING state when target not reached

[TEST] test_stuck_detection
  Distance traveled in 1 second: 182.960526
  State changes: 1
  Final state: MOVING
  ✓ PASS: test_stuck_detection: Player should not get stuck oscillating between states

==================================================
 SUMMARY: 7 passed, 1 failed
==================================================

[FAIL] Some tests failed!
  - test_waypoint_sequential_following
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:131
   at: resume (modules/gdscript/gdscript_function.cpp:1802)
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:131
   at: resume (modules/gdscript/gdscript_function.cpp:1802)

=== Test: player_navigation_progress_test ===
Exit code: 1
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized

==================================================
 PLAYERNAVIGATIONPROGRESSTEST TEST SUITE
==================================================


[TEST] test_player_makes_progress_along_path
  Start position: (975, 150)
  End position: (900, 375)
  Total distance traveled: 535.69
  Final waypoint index: 0
  Current state: ARRIVED
  ✓ PASS: test_player_makes_progress_along_path: Player should make progress along navigation path
Player linked to district: Test District
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:131
   at: resume (modules/gdscript/gdscript_function.cpp:1802)

[TEST] test_waypoint_reaching_with_overshoot
  Player position after movement: (115.884789, 100)
  Distance to waypoint: 4.12
  Waypoint index advanced: True
  ✓ PASS: test_waypoint_reaching_with_overshoot: Player should advance waypoint even with slight overshoot
Player linked to district: Test District

[TEST] test_navigation_stuck_at_intermediate_waypoint
  Start position: (975, 150)
  End position: (834.250916, 367.236084)
  Final waypoint: 3 of 3
  Final state: MOVING
  Made progress: True
  Got stuck: False
  Reached destination: True
  ✓ PASS: test_navigation_stuck_at_intermediate_waypoint: Player should navigate around obstacles without getting stuck
Player linked to district: Test District

[TEST] test_velocity_direction_mismatch_handling
  Waypoint transition 0 -> 1
    Position: (805.414368, 200)
    Velocity: (175.600006, 0) (magnitude: 175.60)
    State: MOVING
    Velocity dot with new direction: 0.05
  Waypoint transition 1 -> 2
    Position: (811.988708, 293.598572)
    Velocity: (-59.336311, 190.9953) (magnitude: 200.00)
    State: DECELERATING
    Velocity dot with new direction: 0.96
  First transition velocity: (175.600006, 0)
  Second transition velocity: (-59.336311, 190.9953)
  Final position: (810.038879, 382.939178)
  Target reached: True
  ✓ PASS: test_velocity_direction_mismatch_handling: Player should handle sharp turns at waypoints without getting stuck
Player linked to district: Test District

[TEST] test_waypoint_index_reset_bug
  Waypoint index changed: 0 -> 1 at position (193.311935, 100)
  Distance to final target: 206.69
  Waypoint index changed: 1 -> 2 at position (295.712036, 100)
  Distance to final target: 104.29
  Waypoint index changed: 2 -> 3 at position (394.912415, 100)
  Distance to final target: 5.09
  Waypoint index changed: 3 -> 0 at position (400, 100)
  Distance to final target: 0.00
  INDEX RESET DETECTED: 3 -> 0
  Indices visited: [0, 1, 2, 3, 0]
  Sequential: False
  Index reset detected: True
  Final position: (400, 100)
  Final state: ARRIVED
  ✗ FAIL: test_waypoint_index_reset_bug: Waypoints should be followed sequentially without resetting to 0
Player linked to district: Test District

==================================================
 SUMMARY: 4 passed, 1 failed
==================================================

[FAIL] Some tests failed!
  - test_waypoint_index_reset_bug
ERROR: Resumed function '_handle_movement()' after yield, but class instance is gone. At script: res://src/characters/player/player.gd:131
   at: resume (modules/gdscript/gdscript_function.cpp:1802)

