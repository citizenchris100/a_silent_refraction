=== Test: coordinate_manager_test ===
Exit code: 124
Godot Engine v3.5.2.stable.official.170ba337a - https://godotengine.org
OpenGL ES 2.0 Renderer: Mesa Intel(R) Graphics (ADL GT2)
 
[DEBUG SINGLETON] Initialized - Press backtick (`) key for console
CoordinateManager initialized
Setting up CoordinateManager test...
Created mock district with scale factor: 2
Created mock camera with position: (500, 500), zoom: (1, 1)
Creating CoordinateManager instance
CoordinateManager initialized
CoordinateManager instance created and configured
Starting CoordinateManager tests...
===== TEST SUITE: District Management =====
Running test: Set Current District
SCRIPT ERROR: Parse Error: Unexpected indentation.
          at: GDScript::reload (built-in:2)
SCRIPT ERROR: Invalid get index 'district_name' (on base: 'Node2D').
          at: set_current_district (res://src/core/coordinate_manager.gd:33)
✓ PASS: Set Current District: set_current_district should update the current district reference
Running test: Get Current District
✓ PASS: Get Current District: get_current_district should return the current district reference
Running test: Handle Null District
ERROR: CoordinateManager: screen_to_world - No camera found
   at: call (modules/gdscript/gdscript_functions.cpp:775)
✓ PASS: Handle Null District: CoordinateManager should handle null district gracefully
Suite completed: 1/1 tests passed
===== TEST SUITE: View Mode Management =====
Running test: Set View Mode
CoordinateManager: View mode changed to WORLD_VIEW
✓ PASS: Set View Mode: set_view_mode should update the current view mode
Running test: Get View Mode
✓ PASS: Get View Mode: get_view_mode should return the current view mode
Running test: Detect View Mode
✗ FAIL: Detect View Mode: detect_view_mode_from_debug should detect and set correct view mode
Suite completed: 0/1 tests passed
===== TEST SUITE: Coordinate Transformations =====
Running test: Screen to World
ERROR: CoordinateManager: screen_to_world - No camera found
   at: call (modules/gdscript/gdscript_functions.cpp:775)
✗ FAIL: Screen to World: screen_to_world should map viewport center to camera position
Running test: World to Screen
ERROR: CoordinateManager: world_to_screen - No camera found
   at: call (modules/gdscript/gdscript_functions.cpp:775)
✗ FAIL: World to Screen: world_to_screen should map camera position to viewport center
Running test: Local to World
✓ PASS: Local to World: local_to_world should correctly transform local coordinates to world coordinates
Running test: World to Local
✓ PASS: World to Local: world_to_local should correctly transform world coordinates to local coordinates
Running test: Transform Coordinates
ERROR: CoordinateManager: screen_to_world - No camera found
   at: call (modules/gdscript/gdscript_functions.cpp:775)
ERROR: CoordinateManager: world_to_screen - No camera found
   at: call (modules/gdscript/gdscript_functions.cpp:775)
✓ PASS: Transform Coordinates: transform_coordinates should correctly handle coordinate space transformations
Suite completed: 1/1 tests passed
===== TEST SUITE: View Mode Transformations =====
Running test: World to Game View
✓ PASS: World to Game View: transform_view_mode_coordinates should correctly convert world view to game view
Running test: Game to World View
✓ PASS: Game to World View: transform_view_mode_coordinates should correctly convert game view to world view
Running test: Same View Mode
✓ PASS: Same View Mode: transform_view_mode_coordinates should return unchanged point for same view mode
Suite completed: 1/1 tests passed
===== TEST SUITE: Camera Detection =====
Running test: Get Current Camera
✗ FAIL: Get Current Camera: _get_current_camera should return the camera from the current district
Running test: Handle Missing Camera
SCRIPT ERROR: Parse Error: Unexpected indentation.
          at: GDScript::reload (built-in:2)
✓ PASS: Handle Missing Camera: _get_current_camera should handle missing camera gracefully
Suite completed: 2/2 tests passed
===== TEST SUITE: Array Transformations =====
Running test: Transform Coordinate Array
✓ PASS: Transform Coordinate Array: transform_coordinate_array should correctly transform all points in array
Running test: Handle Empty Array
✓ PASS: Handle Empty Array: transform_coordinate_array should handle empty array gracefully
Running test: Same View Mode Array
✓ PASS: Same View Mode Array: transform_coordinate_array should return unchanged array for same view mode
Suite completed: 2/2 tests passed
===== TEST SUITE: Validation =====
Running test: Validate Coordinates for View Mode
✓ PASS: Validate Coordinates for View Mode: validate_coordinates_for_view_mode should return true when view modes match
Running test: Handle Validation Mismatch
WARNING: CoordinateManager: Coordinate validation warning - Current view mode is GAME_VIEW but coordinates are expected for WORLD_VIEW
     at: call (modules/gdscript/gdscript_functions.cpp:789)
WARNING: For walkable areas that span the entire background, coordinates should be captured in WORLD_VIEW mode
     at: call (modules/gdscript/gdscript_functions.cpp:789)
WARNING: Press 'Alt+W' to switch to WORLD_VIEW mode before capturing coordinates
     at: call (modules/gdscript/gdscript_functions.cpp:789)
✓ PASS: Handle Validation Mismatch: validate_coordinates_for_view_mode should return false when view modes don't match
Suite completed: 4/4 tests passed
All tests completed.

===== TEST RESULTS =====
Total Tests: 21
Passed: 17
Failed: 4

Failed Tests:
- Detect: Detect View Mode: detect_view_mode_from_debug should detect and set correct view mode
- Screen: Screen to World: screen_to_world should map viewport center to camera position
- World: World to Screen: world_to_screen should map camera position to viewport center
- Get: Get Current Camera: _get_current_camera should return the camera from the current district

